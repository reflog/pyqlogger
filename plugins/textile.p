## $Id$
## This file is part of PyQLogger.
## 
## Copyright (c) 2004 Eli Yukelzon a.k.a Reflog 		
##
## PyQLogger is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.
## 
## PyQLogger is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## 
## You should have received a copy of the GNU General Public License
## along with PyQLogger; if not, write to the Free Software
## Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

import ToolBarManager

class Textile_Plugin(ToolBarManager.ToolbarPlugin):
	image = \
		"\x89\x50\x4e\x47\x0d\x0a\x1a\x0a\x00\x00\x00\x0d" \
		"\x49\x48\x44\x52\x00\x00\x00\x10\x00\x00\x00\x10" \
		"\x08\x06\x00\x00\x00\x1f\xf3\xff\x61\x00\x00\x02" \
		"\x96\x49\x44\x41\x54\x78\x9c\x9d\x93\x3d\x68\x13" \
		"\x61\x18\xc7\x7f\x79\x8d\xf8\xd1\x50\x1b\xae\x76" \
		"\x10\xb4\xb6\x20\x22\x38\x44\x17\xc1\xaf\x0a\x11" \
		"\x04\x45\x83\x50\x74\x50\x0b\x71\x52\xc1\x49\x90" \
		"\x2e\x99\x6e\x39\x45\x70\x71\x50\x10\x2a\x3a\xb8" \
		"\xb8\x89\x53\x15\xba\x38\x39\x28\x05\x0f\x4d\x53" \
		"\x4c\xd3\x18\x9b\xca\x7b\xc9\x7d\xb4\xe5\xce\xdc" \
		"\x3d\x0e\x36\x55\x51\x17\xff\xf0\xc0\xcb\xc3\xc3" \
		"\xcb\xff\xf7\x7c\x00\x60\x9a\xa6\x00\xff\x1b\x00" \
		"\x48\xab\xd5\x92\x76\xbb\x2d\x96\x65\x89\xeb\xba" \
		"\xe2\x79\x9e\x58\x96\x25\x9e\xe7\x89\xef\xfb\x62" \
		"\x59\x96\xb4\x5a\x2d\x09\x82\x40\x4c\xd3\x94\x20" \
		"\x08\x24\x08\x02\x49\x77\x7f\xf0\x3c\x8f\x5a\xad" \
		"\x86\x6d\xdb\xd8\xb6\x8d\x52\x0a\xdb\xb6\x29\x97" \
		"\xcb\x6b\xef\xf9\xf9\x79\x94\x52\xcc\xcc\xcc\x50" \
		"\xad\x56\x01\x48\x75\x11\x4a\xa5\x12\xf9\x7c\x1e" \
		"\xad\x35\x86\x61\xa0\xb5\xe6\xa3\xfd\x8e\x3d\x7b" \
		"\xf7\x93\xcd\x66\x7f\xcb\x03\x18\x86\xc1\xdf\x24" \
		"\x5a\x6b\xd1\x5a\xcb\xf9\x42\x41\xe2\xb8\x23\x80" \
		"\x14\x8b\x45\x71\x5d\x57\x5c\xd7\x95\xb1\xb1\x31" \
		"\x09\x82\x40\x7c\xdf\x17\xd3\x34\x7f\x22\x74\x15" \
		"\x86\x21\x5f\x1a\x0d\x48\xa5\x20\xee\x00\x50\xab" \
		"\xd5\x68\x34\x1a\x28\xa5\x98\x9e\x9e\x5e\xb5\x2f" \
		"\x4c\x4d\x4d\xfd\x89\x00\xa0\xb5\xe6\xc8\x81\x03" \
		"\xdc\xb9\x6d\xb2\x61\xcb\x00\xb9\x5c\x6e\xad\x4f" \
		"\xff\x92\x38\x8e\x23\x8e\xe3\x88\x65\x59\xe2\x38" \
		"\x8e\x5c\xbe\x78\x41\x42\xa7\x2e\x85\xd3\x27\x05" \
		"\x90\xd1\xd1\x51\x01\x64\x62\x62\xe2\xef\x53\x08" \
		"\xc3\x90\x66\xb3\xc9\xe4\xe4\x24\xe3\xe3\xe3\x14" \
		"\x2f\x5e\x00\x05\xbb\x06\xb7\x93\xc4\x1d\xd4\xba" \
		"\x34\x92\xc4\xf4\xf7\x1b\x68\xa7\xcd\xd0\xd0\xd0" \
		"\x9a\xb3\xb5\x45\xca\xe7\xf3\x02\x88\xef\x79\x72" \
		"\xff\xde\x5d\x09\x5b\xf3\xf2\xe8\xde\x2d\x49\xe2" \
		"\x58\x6e\x5e\xbf\x22\x49\xdc\x91\x1b\x57\x8b\xf2" \
		"\xe4\xc9\x63\xe9\xed\xed\x95\xe1\xe1\xe1\x1f\x0e" \
		"\x4a\xa5\x12\x41\x10\x00\x90\xc9\x64\x58\xf2\xdb" \
		"\x88\x08\x71\xb4\x44\x5d\xbb\xc4\xcb\x9a\x6d\x83" \
		"\x3b\xf0\xdb\x5f\xd9\xd8\xd7\x4f\xbd\x5e\xe7\xf8" \
		"\xc8\x08\x8f\x9f\x3e\x45\xfd\xda\x88\x4a\xa5\x02" \
		"\x40\x14\x45\x64\x7b\x7b\x88\x56\x96\x39\x7e\xf4" \
		"\x20\xe5\x8f\xef\x29\x9c\x3a\x41\xb3\x51\xe3\xf2" \
		"\xb9\x02\x3d\xeb\x13\x5e\x3c\x7f\x4e\xa5\x52\x21" \
		"\xbd\x8a\x40\x26\x93\x01\x20\x0d\x24\xd1\x32\xfb" \
		"\xf6\x0c\xf3\x65\x61\x91\x81\xbe\x1e\xa2\x28\x22" \
		"\xdd\x59\x62\x71\x61\x91\x3e\x63\x00\xbd\xd8\x04" \
		"\x20\x97\xcb\xd1\x45\x48\x75\x5d\xa8\x14\xd2\xf9" \
		"\xb6\x44\x18\x0b\x6e\xab\x4d\x27\x49\x08\x57\x56" \
		"\x50\x2a\x45\x7a\x5d\x9a\x37\x6f\x5f\xe1\x79\x7e" \
		"\xb7\x3c\xf5\x1b\x02\xc0\xe6\x2d\x7d\x67\xce\x9c" \
		"\xbd\x04\xa9\x04\x50\xcc\x7e\xaa\xf2\xfe\x43\x85" \
		"\xf2\xec\x1c\xe5\xd9\x2a\x95\xd9\x39\xee\xde\x7f" \
		"\x44\x08\xd7\x60\xf5\x16\x7e\xd5\xe0\xe0\x8e\xfe" \
		"\xb9\xb9\xda\xc8\xee\xa1\x9d\xcf\xce\x9f\x3b\x4b" \
		"\xfd\xf3\x02\x24\x11\x9b\x36\x6e\x40\xb7\x57\xc8" \
		"\x6e\x35\x98\x78\xf0\x90\x97\xaf\xa7\xd4\xe1\x43" \
		"\xc7\xe4\x3b\xff\x94\x9a\xc1\x15\x3f\x4a\x3e\x00" \
		"\x00\x00\x00\x49\x45\x4e\x44\xae\x42\x60\x82"

	def on_click(self):
		text = str(self.parent.sourceEditor.selectedText())
		self.parent.sourceEditor.removeSelectedText()
		line, index = self.parent.sourceEditor.getCursorPosition()
		import textile
		res = textile.textile(text)
		if res:
			self.parent.sourceEditor.insertAt(res, line, index)	

	def getWidget(self):
		page = self.parent.getPage("Plugins")
		button = QPushButton(page)
		bi = QPixmap()
		bi.loadFromData(self.image,"PNG")
		button.setIconSet(QIconSet(bi))
		QToolTip.add(button,"Convert the text through Textile.")
		w = 32
		h = 32
		button.setMaximumSize(QSize(w,h))
		self.parent.connect(button,SIGNAL("clicked()"),self.on_click)
		button.show()

